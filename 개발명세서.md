# 소심하지만 집은 구하고 싶어 - 개발명세서

## 1. 프로젝트 개요
- **앱명**: 소심하지만 집은 구하고 싶어
- **플랫폼**: React Native (iOS/Android)
- **백엔드**: AWS 서버리스 아키텍처

## 2. 시스템 아키텍처
```
React Native App ↔ API Gateway ↔ Lambda Functions ↔ DynamoDB
                                      ↓
                              EventBridge (1분 주기)
                                      ↓
                              크롤링 Lambda → SNS 푸시
```

## 3. 데이터베이스 설계

### 3.1 회원기본 Table
```
PK: userId (Number) = 1 (고정)
- userName (String): 사용자명
- deviceToken (String): 푸시 알림용 디바이스 토큰
- isActive (Boolean): 활성화 여부
- createdAt (String): 생성일시
- lastLoginAt (String): 마지막 로그인 시간
```

### 3.2 회원필터기본 Table
```
PK: userId (Number) = 1 (고정)
PK: filterId (Number) = 1, 2, 3... (자동증가)
- filterName (String): 필터명
- conditions (Map): 필터 조건
  - priceMin (Number): 최소가격 (만원 단위, 선택)
  - priceMax (Number): 최대가격 (만원 단위, 선택)
  - direction (Array): 방향 (["동", "서", "남", "북"], 선택)
  - approvalDateMin (String): 최소 사용승인일 ("YYYY-MM-DD", 선택)
  - approvalDateMax (String): 최대 사용승인일 ("YYYY-MM-DD", 선택)
  - local1 (String): 시 (예: "인천시", 선택)
  - local2 (String): 군/구 (예: "남동구", 선택)
  - local3 (String): 동 (예: "논현동", 선택)
  - propertyType (String): 매물타입 ("LEASE/RENT/SALE", 선택)
  - floorMin (Number): 최소 층수 (선택)
  - floorMax (Number): 최대 층수 (선택)
- isActive (Boolean): 활성화 여부
- createdAt (String): 생성일시
```

### 3.3 매물기본 Table
```
PK: propertyId (String)
- title (String): 매물 제목
- price (Number): 가격 (만원 단위)
- direction (String): 방향 ("동/서/남/북")
- approvalDate (String): 사용승인일 ("YYYY-MM-DD")
- local1 (String): 시
- local2 (String): 군/구
- local3 (String): 동
- propertyType (String): "LEASE/RENT/SALE"
- floor (Number): 층수
- sourceUrl (String): 원본 URL
- sourceSite (String): "직방"
- crawledAt (String): 크롤링 시간
- isActive (Boolean): 활성 여부
```

### 3.4 회원필터매칭매물 Table
```
PK: userId (Number)
SK: matchId (String)
- filterId (String): 필터 ID
- propertyId (String): 매물 ID
- matchedAt (String): 매칭 시간
- notificationSent (Boolean): 알림 발송 여부
- clickedAt (String): 클릭 시간 (선택)
```

## 4. API 명세

상세한 API 명세는 [API명세서.md](./API명세서.md) 파일을 참조하세요.

**주요 API**:
- `POST /v1/filters`: 필터 등록 (Header: X-User-Id)
- `GET /v1/filters`: 필터 목록 조회 (Header: X-User-Id)
- `DELETE /v1/filters/{filterId}`: 필터 삭제 (Header: X-User-Id)
- `GET /v1/history/{filterId}`: 필터별 히스토리 조회 (Header: X-User-Id)

## 5. 주요 기능 구현

### 5.1 기능1: 필터 등록
**플로우**: App → API Gateway → Lambda → DynamoDB

**Lambda 함수**: `registerFilter`
- 입력 검증 (필수값 없음, 모든 조건 선택사항)
- Min/Max 조건 처리:
  - Min만 있으면: "이상" 조건
  - Max만 있으면: "이하" 조건
  - 둘 다 있으면: "범위" 조건
- DynamoDB 저장 (userId=1 고정, filterId는 숫자 자동증가)
- filterId 생성 로직: 해당 userId의 최대 filterId + 1
- 응답 반환

**필터 조건 상세**:
- **가격**: 만원 단위 (예: 10000 = 1억원)
- **방향**: 동/서/남/북 중 다중 선택 가능
- **사용승인일**: YYYY-MM-DD 형식
- **지역**: 시/군구/동 3단계 선택
- **매물타입**: LEASE(전세)/RENT(월세)/SALE(매매)
- **층수**: 숫자 입력

### 5.2 기능2: 알림 발송
**플로우**: EventBridge(1분) → 크롤링Lambda → 매칭Lambda → SNS

**Lambda 함수들**:
1. `crawlZigbang`: 직방 API 크롤링 → 매물기본 Table 저장
2. `matchProperties`: 필터-매물 매칭 → 회원필터매칭매물 Table 저장
3. `sendNotifications`: SNS 푸시 발송

**푸시 메시지 형식**: "[필터명]에 어울리는 집 n건 발견"
- 예시: "강남 전세에 어울리는 집 3건 발견"

### 5.3 기능3: 히스토리 조회
**플로우**: App → API Gateway → Lambda → DynamoDB

**Lambda 함수**: `getHistory`
- 사용자1의 모든 필터에 대한 매칭 히스토리 조회
- 필터별로 그룹화하여 표시
- 매물 정보 조인하여 반환
- Response: {
    "필터1": [매칭된 매물들],
    "필터2": [매칭된 매물들]
  }

## 6. AWS 서비스 구성

### 6.1 컴퓨팅
- **API Gateway**: REST API 엔드포인트
- **Lambda**: 서버리스 함수 실행
- **EventBridge**: 1분 주기 스케줄링

### 6.2 데이터
- **DynamoDB**: NoSQL 데이터베이스 (3개 테이블)

### 6.3 알림
- **SNS**: 푸시 알림 발송

### 6.4 보안
- **IAM**: 권한 관리

## 7. 개발 단계

### Phase 1: 기본 구조
1. DynamoDB 테이블 생성
2. Lambda 함수 기본 틀 구현
3. API Gateway 설정

### Phase 2: 핵심 기능
1. 필터 등록 API 구현
2. 직방 크롤링 Lambda 구현
3. 매칭 로직 구현

### Phase 3: 알림 시스템
1. SNS 설정
2. 푸시 알림 Lambda 구현
3. EventBridge 스케줄링

### Phase 4: 테스트 & 배포
1. 통합 테스트
2. 앱 스토어 배포 준비

## 8. 사용 AWS 서비스 목록

### 8.1 필수 서비스
- **Amazon API Gateway**: REST API 엔드포인트 제공
- **AWS Lambda**: 서버리스 함수 실행 환경
- **Amazon DynamoDB**: NoSQL 데이터베이스 (3개 테이블)
- **Amazon EventBridge**: 1분 주기 스케줄링
- **Amazon SNS**: 푸시 알림 발송

### 8.2 관리 및 보안
- **AWS IAM**: 권한 및 역할 관리
- **Amazon CloudWatch**: 로그 및 모니터링

### 8.3 예상 비용 (월 기준)
- **Lambda**: 무료 티어 범위 내 (100만 요청/월)
- **DynamoDB**: 무료 티어 범위 내 (25GB 저장소)
- **API Gateway**: 무료 티어 범위 내 (100만 요청/월)
- **EventBridge**: $1/월 (100만 이벤트)
- **SNS**: $0.50/월 (100만 푸시)
- **총 예상 비용**: 약 $2-5/월